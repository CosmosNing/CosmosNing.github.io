---
title: 小程序开发2-小程序开发框架
toc: true
mathjax: true
date: 2019-12-26 15:31:58
description: 小程序开发框架简述
tags:
- 前端
- 微信小程序
categories:
- 笔记
---

# 小程序开发框架

## 基本组成

* wxml
* wxss
* javascript
* wxs

### wxml

* 相当于 html
* 语法：<标签 属性1 属性2 ...></标签>

#### 属性总述

|     属性名     |     类型     |      描述      |                   注解                   |
| :------------: | :----------: | :------------: | :--------------------------------------: |
|       id       |    String    | 组件的唯一标识 |             保持整个页面唯一             |
|     class      |    String    |  组件的样式类  |       在对应的 wxss 中定义的样式类       |
|     style      |    String    | 组件的内联样式 |           可以动态设置内联样式           |
|     hidden     |   Boolean    |  组件是否显示  |             所有组件默认显示             |
|     data-*     |     Any      |   自定义属性   | 组件上触发的事件时，会发送给事件处理函数 |
| bind\*/catch\* | EventHandler |   组件的事件   |                 详见事件                 |

#### 数据绑定

* 例 1

  ```html
  <!--index.wxml-->
  
  <view>
  	<text>{{message}}</text>
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          message: "Hello world"
      }
  })
  ```

* 例 2

  ```html
  <!--index.wxml-->
  
  <view>
  	<text data-name="{{theName}}"></text>
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          theName: "Jack"
      }
  })
  ```

* 例 3

  ```html
  <!--index.wxml-->
  
  <view hidden="{{flag ? true : false}}">
  	Hidden
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          flag: false
      }
  })
  ```

#### 列表渲染

* 例 1

  ```html
  <!--index.wxml-->
  
  <view>
  	<block wx:for="{{items}}" wx:for-item="item" wx:key="index">
  		<view>{{index}}:{{item.name}}</view>
  	</block>
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          items:[
              {name: "商品1"},
              {name: "商品2"},
              {name: "商品3"},
              {name: "商品4"}
          ]
      }
  })
  ```

#### 条件渲染

* 例 1

  ```html
  <!--index.wxml-->
  
  <view>今天吃什么？</view>
  <view wx:if="{{condition == 1}}">
  	饺子
  </view>
  <view wx:elif="{{condition == 2}}">
  	米饭
  </view>
  <view wx:else>
  	面食
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          condition: Math.floor(Math.random()*3+1)
      }
  })
  ```


#### 模板引用

* 例 1（内部引用）

  ```html
  <!--index.wxml-->
  
  <!--定义模板文件-->
  <template name="tempItem">    
  	<view>
  		<view>收件人：{{name}}</view>
  		<view>联系方式：{{phone}}</view>
  		<view>地址：{{address}}</view>
  	</view>
  </template>
  
  <!--使用模板文件-->
  <template is="tempItem" data="{{...item}}"><template>    
  ```

  ```js
  // index.js
  
  Page({
      data:{
          item:{
              name: "张三",
              phone: "18888888"
              address: "中国"
          }
      }
  })
  ```

* 例 2（ **import** 外部引用）

  ```html
  <!--index.wxml-->
  
  <import src="a.wxml"></import>    <!--引入外部模板文件-->
  <template is="a"></template>      <!--指定使用模板文件-->
  ```

  ```html
  <!--a.wxml-->
  
  <view>Hello, world</view>
  <template name="a">
  	Hello,world !
  </template>
  ```

* 例 3（ **import** 引用作用域）

  ```html
  <!--index.wxml-->
  
  <import src="a.wxml"></import>
  <template is="a"><template>
  
  <!--显示 This is a.wxml -->
  ```

  ```html
  <!--a.wxml-->
  
  <import src="c.wxml"></import>
  <template is="a">
  	This is a.wxml
  <template>
  <template is="b"><template>
  ```

  ```html
  <!--b.wxml-->
  
  <template is="b">
  	This is b.wxml
  <template>
  ```

* 例 4（ **include** 外部引用）

  ```html
  <!--index.wxml-->
  
  <include src="a.wxml"/>
  <template is="a"></template>
  
  <!-- 显示 Hello, world-->
  ```

  ```html
  <!--a.wxml-->
  
  <template name="a">
  	<view>
  		This is a.wxml
  	</view>
  </template>
  
  <view>Hello, world</view>
  ```


### wxss

* 相当于 css

#### 尺寸单位 rpx

* 响应式像素

#### 样式导入（常用于静态样式）

* 例 1

  ```html
  <!--index.wxml-->
  
  <view class="container">
  	Hello, world !
  </view>
  ```

  ```css
  /**index.wxss**/
  
  @import './assets.wxss';
  
  .container{
      color: red;
  }
  ```

  ```css
  /** assets.wxss **/
  
  .container{
      border: 1px solid #000;
  }
  ```

#### 内联样式（常用于动态样式）

* 例 1

  ```html
  <!--index.wxml-->
  
  <view style="width:500rpx;height:30px;background-color:{{colorValue}}">
      Hello, world!
  </view>
  ```

  ```js
  // index.js
  
  Page({
      data:{
          colorValue: 'red'
      }
  })
  ```

#### 选择器

##### 选择器概览

|      选择器      |      样例      |                 样例描述                 |
| :--------------: | :------------: | :--------------------------------------: |
|      .class      |     .intro     |    选择所有拥有 class=“intro” 的组件     |
|       #id        |   #firstname   |   选择所有拥有 id = “firstname” 的组件   |
|     element      |      view      |            选择所有 view 组件            |
| element, element | view, checkbox | 选择所有文档的 view 组件和 checkbox 组件 |
|     ::after      |  view::after   |         在 view 组件后面插入内容         |
|     ::before     |  view::before  |         在 view 组件前面插入内容         |

##### 选择器优先级

* **! important** > **style** > **#element** > **.element** > **element**

### JavaScript

* 两本书： 《 JavaScript 高级程序设计》、《JavaScript 权威指南》

### wxs

* 相当于 JavaScript

* 例 1（内联）

  ```html
  <!--index.wxml-->
  
  <!--内联定义-->
  <wsx module="m1">
      module.exports ={
      	message: 'Hello,world!'
      }
  </wsx>
  
  <!--内联调用-->
  <view>{{m1.message}}</view>
  ```

* 例 2（外联）

  ```html
  <!--index.wxml-->
  
  <wxs src="./m2.wxs" module="m2"></wxs>
  <view>{{m2.message}}</view>
  ```

  ```js
  // m2.wxs
  
  module.exports = require('./m1.wxs')
  ```

  ```javascript
  // m1.wxs
  
  module.exports = {
      message: "hello,world!"
  }
  ```

* 例 3（注释）

  * 单行注释：**//**
  * 多行注释：**/\*\*/**

## MINA 框架

* 包括三个部分
  * **View**（视图层）：包含 **page** 文件
  * **App Service**（逻辑层）：包括 **Manager** （业务逻辑）、**API**（业务逻辑接口）
  * **Native**（系统层）：包括 **JSBridge** 、**微信能力**、**离线存储**、**网络请求**等

## 生命周期

### 程序生命周期

* onLaunch：生命周期回调——监听小程序初始化（第一次启动时触发）
* onShow：生命周期回调——监听小程序启动或切前台（在 onLaunch 之后）
* onHide：生命周期回调——监听小程序切后台。
* onError：错误监听函数。

### 页面生命周期

* onLoad：生命周期回调—监听页面加载

* onShow：生命周期回调—监听页面显示
* onReady：生命周期回调—监听页面初次渲染完成
* onHide：生命周期回调—监听页面隐藏
* onUnload：生命周期回调—监听页面卸载

## 路由

|  路由方式  |                           触发时机                           | 路由前页面 |    路由后页面    |
| :--------: | :----------------------------------------------------------: | :--------: | :--------------: |
|   初始化   |                    小程序打开的第一个页面                    |     无     |  onLoad, onShow  |
| 打开新页面 | 调用 API `wx.navigateTo` 或使用组件 `<navigator open-type="navigateTo"/>` |   onHide   |  onLoad, onShow  |
| 页面重定向 | 调用 API `wx.redirectTo` 或使用组件 `<navigator open-type="redirectTo"/>` |  onUnload  |  onLoad, onShow  |
|  页面返回  | 调用 API `wx.navigateBack` 或使用组件`<navigator open-type="navigateBack">`或用户按左上角返回按钮 |  onUnload  |      onShow      |
|  Tab 切换  | 调用 API `wx.switchTab` 或使用组件 `<navigator open-type="switchTab"/>`或用户切换 Tab |     无     | 具体情况具体分析 |
|   重启动   | 调用 API `wx.reLaunch` 或使用组件 `<navigator open-type="reLaunch"/>` |  onUnload  |  onLoad, onShow  |


## 事件

* 例 1（基本写法）

  ```html
  <!--index.wxml-->
  
  <view>
      <view class="btn" bindtap="clickMe">
          点击我
      </view>
  </view>
  ```

  ```js
  // index.js
  
  Page({
      clickMe(e){
          console.log(e);
      }
  })
  ```

* 进阶及其他写法详见：<https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html>